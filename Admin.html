<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { box-sizing: border-box; font-family: 'Sarabun', sans-serif; }
        body { margin: 0; background-color: #f4f7f6; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 260px; background: #2c3e50; color: white; display: flex; flex-direction: column; padding: 20px 0; transition: 0.3s; }
        .sidebar-header { text-align: center; padding: 0 20px 20px; border-bottom: 1px solid #34495e; font-size: 1.2rem; font-weight: 600; }
        .sidebar-menu { list-style: none; padding: 0; margin: 20px 0; flex-grow: 1; }
        .sidebar-menu li { padding: 15px 25px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; }
        .sidebar-menu li:hover { background: #34495e; }
        .sidebar-menu li.active { background: #764ba2; border-left: 5px solid #fff; }
        .sidebar-menu li span { margin-left: 10px; }
        .main-content { flex-grow: 1; overflow-y: auto; padding: 30px; background: #f4f7f6; }
        .header-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .clock-container { background: white; padding: 10px 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: center; gap: 12px; border: 1px solid #e0e0e0; }
        .clock-label { font-size: 0.85rem; color: #666; }
        .clock-time { font-size: 1.2rem; color: #764ba2; font-weight: 600; min-width: 80px; }
        .content-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 25px; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: #333; font-weight: 600; }
        .status-pill { padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; min-width: 90px; display: inline-block; text-align: center; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-success { background: #d4edda; color: #155724; }
        .btn-logout { padding: 15px 25px; background: #c0392b; color: white; text-align: center; cursor: pointer; border: none; font-weight: 600; }
        .btn-add { background: #2ecc71; color: white; border: none; padding: 12px 25px; border-radius: 6px; cursor: pointer; font-size: 1rem; width: 100%; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.55); backdrop-filter: blur(3px); align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 30px; border-radius: 15px; width: 90%; max-width: 400px; text-align: center; }
        .modal-buttons { display: flex; gap: 10px; justify-content: center; margin-top: 25px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #444; }
        .form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">üõ† Admin Panel</div>
    <ul class="sidebar-menu">
        <li class="active" onclick="showPage('dashboard', event)">üè† <span>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span></li>
        <li onclick="showPage('repair-status', event)">üìã <span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</span></li>
        <li onclick="showPage('add-job', event)">‚ûï <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°</span></li>
    </ul>
    <div class="btn-logout" onclick="openLogoutModal()">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</div>
</div>

<div class="main-content">
    <div class="header-bar">
        <h2 id="page-title">Dashboard / ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</h2>
        <div class="clock-container">
            <div class="clock-label">üìÖ <span id="current-date">-</span></div>
            <div style="width: 1px; height: 20px; background: #eee;"></div>
            <div class="clock-time" id="digital-clock">00:00:00</div>
        </div>
    </div>

    <div id="dashboard" class="page-content">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
            <div class="content-card" style="border-left: 5px solid #764ba2;"><p>‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p><h3 id="total-count">...</h3></div>
            <div class="content-card" style="border-left: 5px solid #f1c40f;"><p>‡∏£‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á</p><h3 id="pending-count">...</h3></div>
            <div class="content-card" style="border-left: 5px solid #2ecc71;"><p>‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</p><h3 id="success-count">...</h3></div>
        </div>
        <button onclick="fetchData()" style="padding: 10px; cursor: pointer; margin-top: 20px;">üîÑ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Sheets</button>
    </div>

    <div id="repair-status" class="page-content" style="display:none;">
        <div class="content-card">
            <table>
                <thead>
                    <tr>
                        <th>‡∏•‡∏≥‡∏î‡∏±‡∏ö</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á/‡πÄ‡∏ö‡∏≠‡∏£‡πå</th><th>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th><th>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="repair-data-table">
                    <tr><td colspan="7" style="text-align:center;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <div id="add-job" class="page-content" style="display:none;">
        <div class="content-card" style="max-width: 500px; margin: auto;">
            <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</h3>
            <form id="jobForm">
                <div class="form-group"><label>‡∏ú‡∏π‡πâ‡πÅ‡∏à‡πâ‡∏á</label><input type="text" id="name" required></div>
                <div class="form-group"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</label><input type="tel" id="phone" required></div>
                <div class="form-group"><label>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label><input type="text" id="EQM" required></div>
                <div class="form-group"><label>‡∏≠‡∏≤‡∏Å‡∏≤‡∏£</label><input type="text" id="sym" required></div>
                <button type="submit" id="adminSubmitBtn" class="btn-add">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </form>
        </div>
    </div>
</div>

<div id="logoutModal" class="modal">
    <div class="modal-content">
        <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?</h3>
        <div class="modal-buttons">
            <button class="btn-cancel" onclick="closeLogoutModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn-confirm" onclick="confirmLogout()">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxQ6iZIhxFxBXxJVxIUYx7OQkDvLfvuRWNJMhLs20xkZMjqt0eJjJuCLcaldL1TQIo9/exec';
    let repairData = [];

    async function fetchData() {
        try {
            const response = await fetch(SCRIPT_URL);
            const data = await response.json();
            repairData = data.slice(1); 
            renderTable();
            renderDashboard();
        } catch (error) {
            console.error(error);
            document.getElementById('repair-data-table').innerHTML = '<tr><td colspan="7" style="text-align:center; color:red;">‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß</td></tr>';
        }
    }

    function renderTable() {
        const tbody = document.getElementById('repair-data-table');
        tbody.innerHTML = '';
        repairData.forEach((row, index) => {
            const tr = document.createElement('tr');
            const statusText = row[5] || '‡∏£‡∏≠‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á';
            const statusClass = statusText === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' ? 'status-success' : 'status-pending';
            tr.innerHTML = `
                <td>${index + 1}</td>
                <td>${new Date(row[0]).toLocaleDateString('th-TH')}</td>
                <td><strong>${row[1]}</strong><br><small>üìû ${row[2]}</small></td>
                <td>${row[3]}</td>
                <td>${row[4]}</td>
                <td><span class="status-pill ${statusClass}">${statusText}</span></td>
                <td><small style="color:gray;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ô Sheets</small></td>
            `;
            tbody.appendChild(tr);
        });
    }

    function renderDashboard() {
        document.getElementById('total-count').innerText = repairData.length;
        document.getElementById('pending-count').innerText = repairData.filter(r => r[5] !== '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô').length;
        document.getElementById('success-count').innerText = repairData.filter(r => r[5] === '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô').length;
    }

    document.getElementById('jobForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const btn = document.getElementById('adminSubmitBtn');
        btn.disabled = true;
        const data = {
            name: document.getElementById('name').value,
            phone: document.getElementById('phone').value,
            EQM: document.getElementById('EQM').value,
            sym: document.getElementById('sym').value
        };
        fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
        .then(() => { alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!'); this.reset(); fetchData(); showPage('repair-status'); })
        .finally(() => { btn.disabled = false; });
    });

    function showPage(pageId, event) {
        document.querySelectorAll('.page-content').forEach(p => p.style.display = 'none');
        document.querySelectorAll('.sidebar-menu li').forEach(l => l.classList.remove('active'));
        document.getElementById(pageId).style.display = 'block';
        if(event) event.currentTarget.classList.add('active');
        document.getElementById('page-title').innerText = pageId === 'dashboard' ? '‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å' : (pageId === 'repair-status' ? '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°' : '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°');
    }

    function updateClock() {
        const now = new Date();
        document.getElementById('digital-clock').innerText = now.toLocaleTimeString('th-TH');
        document.getElementById('current-date').innerText = now.toLocaleDateString('th-TH', {day:'numeric', month:'short', year:'numeric'});
    }

    function openLogoutModal() { document.getElementById("logoutModal").style.display = "flex"; }
    function closeLogoutModal() { document.getElementById("logoutModal").style.display = "none"; }
    function confirmLogout() { window.location.href = "index.html"; }

    setInterval(updateClock, 1000);
    updateClock();
    fetchData();
</script>

</body>
</html>